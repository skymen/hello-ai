<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI News Summarizer</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        background: #212121;
        color: #ececec;
        height: 100vh;
        display: flex;
        flex-direction: column;
        transition: margin-right 0.3s ease;
      }

      body.sidebar-open {
        margin-right: 50%;
      }

      .header {
        padding: 16px 20px;
        border-bottom: 1px solid #343541;
        background: #343541;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .header h1 {
        font-size: 16px;
        font-weight: 600;
        color: #ececec;
      }

      .chat-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        max-width: 768px;
        margin: 0 auto;
        width: 100%;
      }

      .chat-area {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
      }

      .message {
        margin-bottom: 24px;
        display: flex;
        gap: 16px;
      }

      .message.user-message {
        justify-content: flex-end;
      }

      .avatar {
        width: 30px;
        height: 30px;
        border-radius: 2px;
        flex-shrink: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        font-weight: 600;
      }

      .user-avatar {
        background: #10a37f;
        color: white;
      }

      .ai-avatar {
        background: #19c37d;
        color: white;
      }

      .message-content {
        flex: 1;
        line-height: 1.6;
        font-size: 16px;
      }

      .user-message .message-content {
        color: #ececec;
        background: #10a37f;
        padding: 12px 16px;
        border-radius: 18px 18px 4px 18px;
        max-width: 70%;
        margin-left: auto;
      }

      .ai-message .message-content {
        color: #ececec;
      }

      .thinking-container {
        display: none;
        margin: 12px 0;
      }

      .thinking-header {
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        color: #9ca3af;
        font-size: 14px;
        padding: 8px 12px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 6px;
        transition: all 0.2s ease;
        border: 1px solid transparent;
      }

      .thinking-header:hover {
        background: rgba(255, 255, 255, 0.08);
        border-color: #3e3e3e;
      }

      .thinking-content {
        display: none;
        font-size: 13px;
        color: #b4b4b4;
        line-height: 1.5;
        padding: 16px;
        background: #2a2a2a;
        border-radius: 6px;
        margin-top: 8px;
        border-left: 3px solid #10a37f;
      }

      .thinking-dots {
        display: inline-flex;
        align-items: center;
        gap: 2px;
      }

      .thinking-dot {
        width: 4px;
        height: 4px;
        background: #9ca3af;
        border-radius: 50%;
        animation: thinking-pulse 1.4s infinite ease-in-out;
      }

      .thinking-dot:nth-child(1) {
        animation-delay: -0.32s;
      }
      .thinking-dot:nth-child(2) {
        animation-delay: -0.16s;
      }
      .thinking-dot:nth-child(3) {
        animation-delay: 0s;
      }

      @keyframes thinking-pulse {
        0%,
        80%,
        100% {
          opacity: 0.3;
          transform: scale(0.8);
        }
        40% {
          opacity: 1;
          transform: scale(1);
        }
      }

      .sources-container {
        margin: 12px 0;
        display: none;
      }

      .sources-header {
        font-size: 14px;
        color: #9ca3af;
        margin-bottom: 12px;
        padding: 8px 12px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 6px;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 8px;
      }

      .sources-header:hover {
        background: rgba(255, 255, 255, 0.08);
      }

      .sources-header-content {
        display: flex;
        flex-direction: column;
        flex: 1;
      }

      .sources-status-text {
        font-size: 14px;
        color: #9ca3af;
      }

      .sources-preview-text {
        font-size: 12px;
        color: #6b7280;
        margin-top: 2px;
        opacity: 0.8;
      }

      .sources-list-container {
        max-height: 200px;
        overflow-y: auto;
        display: none;
        margin-top: 8px;
        padding-right: 8px;
      }

      .sources-list-container::-webkit-scrollbar {
        width: 6px;
      }

      .sources-list-container::-webkit-scrollbar-track {
        background: #2a2a2a;
        border-radius: 3px;
      }

      .sources-list-container::-webkit-scrollbar-thumb {
        background: #4a4a4a;
        border-radius: 3px;
      }

      .sources-list-container::-webkit-scrollbar-thumb:hover {
        background: #5a5a5a;
      }

      .source-preview {
        padding: 6px 12px;
        margin: 3px 0;
        font-size: 13px;
        border-radius: 4px;
        opacity: 0;
        animation: fadeIn 0.4s ease forwards;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .source-preview.relevant {
        background: rgba(16, 163, 127, 0.1);
        color: #10a37f;
        border: 1px solid rgba(16, 163, 127, 0.2);
      }

      .source-preview.irrelevant {
        background: rgba(156, 163, 175, 0.05);
        color: #6b7280;
        border: 1px solid rgba(156, 163, 175, 0.1);
      }

      .source-status {
        font-size: 11px;
        padding: 2px 6px;
        border-radius: 4px;
        font-weight: 500;
      }

      .status-relevant {
        background: rgba(16, 163, 127, 0.2);
        color: #10a37f;
      }

      .status-irrelevant {
        background: rgba(156, 163, 175, 0.1);
        color: #9ca3af;
      }

      .caret {
        transition: transform 0.2s ease;
      }

      .caret.open {
        transform: rotate(90deg);
      }

      @keyframes fadeIn {
        to {
          opacity: 1;
        }
      }

      .news-summary {
        display: none;
      }

      .news-item {
        margin: 20px 0;
        padding-bottom: 16px;
        border-bottom: 1px solid #3e3e3e;
      }

      .news-item:last-child {
        border-bottom: none;
      }

      .news-headline {
        font-weight: 600;
        font-size: 18px;
        color: #ececec;
        margin-bottom: 8px;
      }

      .news-content {
        color: #b4b4b4;
        line-height: 1.6;
        margin-bottom: 10px;
      }

      .source-link {
        color: #10a37f;
        text-decoration: none;
        font-size: 14px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        background: rgba(16, 163, 127, 0.1);
        padding: 6px 12px;
        border-radius: 16px;
        border: 1px solid rgba(16, 163, 127, 0.2);
        transition: all 0.2s ease;
        margin: 2px 4px 2px 0;
        font-weight: 500;
      }

      .source-link:hover {
        background: rgba(16, 163, 127, 0.15);
        border-color: rgba(16, 163, 127, 0.3);
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(16, 163, 127, 0.2);
      }

      .source-link::before {
        content: "🔗";
        font-size: 12px;
        opacity: 0.8;
      }

      .word-animate {
        opacity: 0;
        animation: wordFadeIn 0.3s ease forwards;
      }

      @keyframes wordFadeIn {
        from {
          opacity: 0;
          transform: translateY(4px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .ai-helper-message {
        margin: 8px 0;
        padding: 8px 12px;
        background: rgba(25, 195, 125, 0.1);
        border-left: 3px solid #19c37d;
        border-radius: 4px;
        font-size: 13px;
        color: #19c37d;
        font-style: italic;
        display: none;
      }

      .helper-message-container {
        margin: 16px 0;
      }

      .input-area {
        padding: 20px;
        border-top: 1px solid #343541;
        background: #212121;
      }

      .input-container {
        position: relative;
        max-width: 768px;
        margin: 0 auto;
      }

      .input-wrapper {
        position: relative;
        display: flex;
        align-items: flex-end;
        background: #40414f;
        border: 1px solid #565869;
        border-radius: 12px;
        padding: 12px 52px 12px 16px;
        transition: border-color 0.2s;
      }

      .input-wrapper:focus-within {
        border-color: #10a37f;
      }

      textarea {
        flex: 1;
        background: transparent;
        border: none;
        outline: none;
        color: #ececec;
        font-size: 16px;
        line-height: 1.5;
        resize: none;
        max-height: 200px;
        font-family: inherit;
        transition: opacity 0.3s ease;
      }

      textarea:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      textarea::placeholder {
        color: #8e8ea0;
      }

      .send-button {
        position: absolute;
        right: 12px;
        bottom: 12px;
        width: 32px;
        height: 32px;
        border: none;
        border-radius: 6px;
        background: #565869;
        color: #8e8ea0;
        cursor: not-allowed;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
      }

      .send-button.enabled {
        background: #10a37f;
        color: white;
        cursor: pointer;
      }

      .send-button.enabled:hover {
        background: #0d8b6b;
      }

      .sidebar {
        position: fixed;
        right: -50%;
        top: 0;
        width: 50%;
        height: 100vh;
        background: #343541;
        border-left: 1px solid #565869;
        transition: right 0.3s ease;
        z-index: 1000;
      }

      .sidebar.open {
        right: 0;
      }

      .sidebar-header {
        padding: 16px 20px;
        background: #40414f;
        border-bottom: 1px solid #565869;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .sidebar-header h3 {
        color: #ececec;
        font-size: 16px;
        font-weight: 600;
      }

      .close-btn {
        background: none;
        border: none;
        font-size: 20px;
        cursor: pointer;
        color: #8e8ea0;
        padding: 4px;
      }

      .close-btn:hover {
        color: #ececec;
      }

      .sidebar-content {
        height: calc(100vh - 64px);
      }

      .sidebar iframe {
        width: 100%;
        height: 100%;
        border: none;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>AI News Summarizer</h1>
    </div>

    <div class="chat-container">
      <div class="chat-area" id="chatArea">
        <!-- Messages will appear here -->
      </div>

      <div class="input-area">
        <div class="input-container">
          <div class="input-wrapper">
            <textarea
              id="messageInput"
              placeholder="Message AI News Summarizer..."
              rows="1"
            ></textarea>
            <button class="send-button" id="sendButton" onclick="sendMessage()">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" />
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <h3>Article Preview</h3>
        <button class="close-btn" onclick="closeSidebar()">&times;</button>
      </div>
      <div class="sidebar-content">
        <iframe id="articleFrame" src="about:blank"></iframe>
      </div>
    </div>

    <script src="./data.js"></script>
    <script src="./textbox.js"></script>

    <script>
      // Utility function to create message containers
      function createMessageContainer(isUser = false) {
        const chatArea = document.getElementById("chatArea");
        const messageDiv = document.createElement("div");
        messageDiv.className = `message ${isUser ? "user-message" : ""}`;

        if (isUser) {
          const messageContent = document.createElement("div");
          messageContent.className = "message-content";

          const avatar = document.createElement("div");
          avatar.className = "avatar user-avatar";
          avatar.textContent = "You";

          messageDiv.appendChild(messageContent);
          messageDiv.appendChild(avatar);
        } else {
          const avatar = document.createElement("div");
          avatar.className = "avatar ai-avatar";
          avatar.textContent = "AI";

          const messageContent = document.createElement("div");
          messageContent.className = "message-content";

          messageDiv.appendChild(avatar);
          messageDiv.appendChild(messageContent);
        }

        chatArea.appendChild(messageDiv);
        chatArea.scrollTop = chatArea.scrollHeight;

        return messageDiv.querySelector(".message-content");
      }

      // Async function to animate words with delays
      async function animateWordsIn(element, text, delay = 100) {
        return new Promise((resolve) => {
          const words = text.split(" ");
          element.innerHTML = "";

          words.forEach((word, index) => {
            const span = document.createElement("span");
            span.textContent = word + " ";
            span.className = "word-animate";
            span.style.animationDelay = `${index * delay}ms`;
            element.appendChild(span);
          });

          // Resolve when all animations are complete
          const totalDuration = words.length * delay + 300; // 300ms for the last word animation
          setTimeout(resolve, totalDuration);
        });
      }

      // Async function to add content to current message with continuous word animation
      async function addToCurrentMessage(content, delay = 100) {
        return new Promise((resolve) => {
          const lastMessage = document.querySelector(
            ".message:last-child .message-content"
          );

          // Get existing word count to continue animation sequence
          const existingSpans = lastMessage.querySelectorAll(".word-animate");
          const startingWordIndex = existingSpans.length;

          const words = content.split(" ");

          words.forEach((word, index) => {
            const span = document.createElement("span");
            span.textContent = word + " ";
            span.className = "word-animate";
            // Continue animation from where it left off
            span.style.animationDelay = `${
              (startingWordIndex + index) * delay
            }ms`;
            lastMessage.appendChild(span);
          });

          // Resolve when all new words are animated
          const totalDuration = words.length * delay + 300;
          setTimeout(resolve, totalDuration);
        });
      }

      // Async function to show thinking animation
      async function showThinking(title, content, duration = 3000) {
        return new Promise((resolve) => {
          const thinkingId = `thinkingContainer${Date.now()}`;
          const thinkingHtml = `
            <div class="thinking-container" id="${thinkingId}">
              <div class="thinking-header" onclick="toggleThinking('${thinkingId}')">
                🧠 ${title}
                <div class="thinking-dots" id="${thinkingId}Dots">
                  <div class="thinking-dot"></div>
                  <div class="thinking-dot"></div>
                  <div class="thinking-dot"></div>
                </div>
                <span class="caret" id="${thinkingId}Caret" style="display: none;">▶</span>
              </div>
              <div class="thinking-content" id="${thinkingId}Content">
                ${content}
              </div>
            </div>
          `;

          const lastMessage = document.querySelector(
            ".message:last-child .message-content"
          );
          lastMessage.innerHTML += thinkingHtml;
          document.getElementById(thinkingId).style.display = "block";

          // Hide dots and show caret after duration
          setTimeout(() => {
            document.getElementById(`${thinkingId}Dots`).style.display = "none";
            document.getElementById(`${thinkingId}Caret`).style.display =
              "inline";
            resolve();
          }, duration);
        });
      }

      // Async function to show a message with word-by-word animation
      async function showMessage(content, delay = 100) {
        const messageElement = createMessageContainer(false);
        return animateWordsIn(messageElement, content, delay);
      }

      // Async function to show a title with word-by-word animation
      async function showTitle(
        content,
        className = "news-headline",
        delay = 100
      ) {
        return new Promise(async (resolve) => {
          const titleHtml = `<div class="${className}">${content}</div>`;
          const lastMessage = document.querySelector(
            ".message:last-child .message-content"
          );
          lastMessage.innerHTML += titleHtml;

          const titleElement = lastMessage.querySelector(
            `.${className}:last-child`
          );
          await animateWordsIn(titleElement, content, delay);
          resolve();
        });
      }

      // Async function to show a link with word-by-word animation
      async function showLink(text, url, delay = 100) {
        return new Promise(async (resolve) => {
          const linkHtml = `<a class="source-link" onclick="openSource('${url}')">${text}</a>`;
          const lastMessage = document.querySelector(
            ".message:last-child .message-content"
          );
          lastMessage.innerHTML += linkHtml;

          const linkElement = lastMessage.querySelector(
            ".source-link:last-child"
          );
          await animateWordsIn(linkElement, text, delay);
          resolve();
        });
      }

      // Async function to show content with word-by-word animation
      async function showContent(
        content,
        className = "news-content",
        delay = 100
      ) {
        return new Promise(async (resolve) => {
          const contentHtml = `<div class="${className}">${content}</div>`;
          const lastMessage = document.querySelector(
            ".message:last-child .message-content"
          );
          lastMessage.innerHTML += contentHtml;

          const contentElement = lastMessage.querySelector(
            `.${className}:last-child`
          );
          await animateWordsIn(contentElement, content, delay);
          resolve();
        });
      }

      // Toggle function for thinking sections
      function toggleThinking(thinkingId) {
        const content = document.getElementById(`${thinkingId}Content`);
        const caret = document.getElementById(`${thinkingId}Caret`);
        const isOpen = content.style.display === "block";

        content.style.display = isOpen ? "none" : "block";
        if (caret) {
          caret.classList.toggle("open", !isOpen);
        }
      }

      // Main async AI response function
      async function handleAIResponse() {
        // Create empty AI message container
        createMessageContainer(false);

        // First thinking phase
        await showThinking(
          "Thinking",
          `
          The user is asking me to summarize current news. Since they mentioned in the past they've been feeling under the weather and can't "doom scroll" anymore, they seem to want a general overview of what's happening without having to go through potentially negative or overwhelming news themselves.<br><br>
          
          Since my knowledge cutoff is January 2025 and the current date is June 15, 2025, I should search for recent news to provide them with current information. This is exactly the type of query that requires web search - they're asking for current/recent news which changes daily.<br><br>
          
          I should search for general news and try to give them a balanced summary that's informative but not overwhelming, given their mention of not wanting to doom scroll.
        `,
          3000
        );

        // Helper message
        await addToCurrentMessage(
          "💡 Now I'll search for current news sources to find the most relevant articles for you."
        );

        // Source searching phase
        await showSourceSearching();

        // Second thinking phase
        await showThinking(
          "Filtering and organizing",
          `
          Now I need to filter through these sources and select the most relevant, balanced news items. I want to avoid purely negative or sensationalist content since the user mentioned not wanting to doom scroll.<br><br>
          
          I'll focus on:<br>
          • Significant global developments that are important to know<br>
          • Positive scientific or technological breakthroughs<br>
          • Economic updates that affect daily life<br>
          • Climate news that shows progress rather than just problems<br><br>
          
          I'll present 4 key stories with clear headlines and concise summaries, making sure to maintain an informative but not overwhelming tone.
        `,
          2000
        );

        // Helper message
        await addToCurrentMessage(
          "💡 I've analyzed all the sources. Now I'll organize the most important news stories for you."
        );

        // Helper message
        await addToCurrentMessage(
          "💡 Perfect! Now I'll compile the most important news stories for you."
        );

        // Show news summary
        await showNewsSummary();
      }

      // Async function to show source searching with animation
      async function showSourceSearching() {
        return new Promise((resolve) => {
          const sourcesHtml = `
            <div class="sources-container" id="sourcesContainer">
              <div class="sources-header" onclick="toggleSources()">
                <div class="sources-header-content">
                  <div class="sources-status-text">
                    🔍 Searching news sources
                    <div class="thinking-dots" id="searchingDots">
                      <div class="thinking-dot"></div>
                      <div class="thinking-dot"></div>
                      <div class="thinking-dot"></div>
                    </div>
                  </div>
                  <div class="sources-preview-text" id="currentSearching">
                    Currently checking: CNN Breaking News...
                  </div>
                </div>
                <span class="caret" id="sourcesCaret">▶</span>
              </div>
              <div class="sources-list-container" id="sourcesListContainer">
                <div id="sourcesList"></div>
              </div>
            </div>
          `;

          const lastMessage = document.querySelector(
            ".message:last-child .message-content"
          );
          lastMessage.innerHTML += sourcesHtml;
          document.getElementById("sourcesContainer").style.display = "block";

          const sourcesList = document.getElementById("sourcesList");
          const currentSearchingText =
            document.getElementById("currentSearching");
          let currentIndex = 0;

          const relevantSources = [
            "Reuters - Global Climate Agreement",
            "BBC News - Tech Safety Initiative",
            "Bloomberg - Market Recovery",
            "Nature - Quantum Computing Breakthrough",
            "Associated Press - Economic Indicators",
          ];

          const irrelevantSources = [
            "Local Tribune - City Council Meeting",
            "Sports Weekly - Basketball Scores",
            "Celebrity Gossip - Red Carpet Events",
            "Gaming News - Latest Video Game",
            "Food Blog - Restaurant Reviews",
            "Weather Channel - Local Forecast",
            "Entertainment Tonight - Movie Premieres",
            "Fashion Weekly - Style Trends",
            "Pet Care - Dog Training Tips",
            "Travel Guide - Tourist Destinations",
          ];

          const websitePreviews = [
            "Breaking: Global leaders announce climate deal...",
            "Tech giants unite for AI safety standards...",
            "Markets surge on positive economic data...",
            "Scientists achieve quantum computing milestone...",
            "Economic indicators show steady growth...",
            "City council approves new budget proposal...",
            "Lakers defeat Warriors in overtime thriller...",
            "Celebrity spotted at movie premiere...",
            "New indie game takes gaming world by storm...",
            "Top 10 restaurants to try this weekend...",
            "Sunny skies expected through the weekend...",
            "Hollywood stars dazzle at award ceremony...",
            "Spring fashion trends you need to know...",
            "Expert tips for training your new puppy...",
            "Hidden gems: 5 must-visit destinations...",
          ];

          const allSearchSources = [...relevantSources, ...irrelevantSources];

          const searchInterval = setInterval(() => {
            if (currentIndex >= allSearchSources.length) {
              clearInterval(searchInterval);
              // Update header to show completion
              document.querySelector(
                "#sourcesContainer .sources-header"
              ).innerHTML = `
                <div class="sources-header-content">
                  <div class="sources-status-text">🔍 Found ${relevantSources.length} relevant sources</div>
                </div>
                <span class="caret" id="sourcesCaret">▶</span>
              `;
              resolve();
              return;
            }

            // Update the preview text
            if (currentIndex < websitePreviews.length) {
              currentSearchingText.textContent = `Currently checking: ${websitePreviews[currentIndex]}`;
            }

            const sourceDiv = document.createElement("div");
            const isRelevant = relevantSources.includes(
              allSearchSources[currentIndex]
            );

            sourceDiv.className = `source-preview ${
              isRelevant ? "relevant" : "irrelevant"
            }`;
            sourceDiv.innerHTML = `
              <span>${isRelevant ? "✓" : "○"} ${
              allSearchSources[currentIndex]
            }</span>
              <span class="source-status ${
                isRelevant ? "status-relevant" : "status-irrelevant"
              }">
                ${isRelevant ? "Relevant" : "Irrelevant"}
              </span>
            `;
            sourcesList.appendChild(sourceDiv);

            // Auto-scroll to bottom of sources list
            const container = document.getElementById("sourcesListContainer");
            container.scrollTop = container.scrollHeight;

            currentIndex++;
          }, 300);
        });
      }

      function toggleSources() {
        const content = document.getElementById("sourcesListContainer");
        const caret = document.getElementById("sourcesCaret");
        const isOpen = content.style.display === "block";

        content.style.display = isOpen ? "none" : "block";
        if (caret) {
          caret.classList.toggle("open", !isOpen);
        }
      }

      async function showNewsSummary() {
        // Add a news item container
        const newsHtml = `<div class="news-summary"></div>`;
        const lastMessage = document.querySelector(
          ".message:last-child .message-content"
        );
        lastMessage.innerHTML += newsHtml;

        const newsSummary = lastMessage.querySelector(".news-summary");
        newsSummary.style.display = "block";

        // News stories data
        const newsStories = [
          {
            headline: "Global Climate Summit Reaches Historic Agreement",
            content:
              "World leaders from 195 countries have agreed on ambitious new climate targets, setting a pathway to limit global warming to 1.5°C. The agreement includes unprecedented funding commitments for renewable energy infrastructure and climate adaptation measures.",
            source: "Source: Reuters Climate Report",
            url: sourceUrls[0],
          },
          {
            headline: "Major Tech Companies Announce AI Safety Initiative",
            content:
              "Leading technology companies have launched a collaborative effort to establish global standards for artificial intelligence safety and ethics. The initiative aims to ensure responsible AI development while fostering innovation across industries.",
            source: "Source: TechCrunch Analysis",
            url: sourceUrls[1],
          },
          {
            headline: "Economic Markets Show Strong Recovery Signals",
            content:
              "Global stock markets have posted significant gains following positive economic indicators and reduced inflation rates. Analysts predict continued growth momentum through the next quarter, with particular strength in technology and renewable energy sectors.",
            source: "Source: Financial Times Market Update",
            url: sourceUrls[2],
          },
          {
            headline: "Breakthrough in Quantum Computing Achieved",
            content:
              "Researchers have successfully demonstrated a quantum computer capable of solving complex problems exponentially faster than traditional computers. This milestone brings practical quantum computing applications significantly closer to reality.",
            source: "Source: Nature Scientific Journal",
            url: sourceUrls[3],
          },
        ];

        // Create all the HTML structure first
        let summaryContent = "";

        for (let i = 0; i < newsStories.length; i++) {
          const story = newsStories[i];
          summaryContent += `
            <div class="news-item">
              <div class="news-headline">${story.headline}</div>
              <div class="news-content">${story.content}</div>
              <a class="source-link" onclick="openSource('${story.url}')">${story.source}</a>
            </div>
          `;
        }

        // Add sources referenced section
        summaryContent += `
          <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #3e3e3e;">
            <strong>Sources Referenced:</strong><br>
            <a class="source-link" onclick="openSource('${sourceUrls[0]}')">Reuters</a> • 
            <a class="source-link" onclick="openSource('${sourceUrls[1]}')">BBC News</a> • 
            <a class="source-link" onclick="openSource('${sourceUrls[2]}')">The New York Times</a> • 
            <a class="source-link" onclick="openSource('${sourceUrls[3]}')">Washington Post</a> • 
            <a class="source-link" onclick="openSource('${sourceUrls[4]}')">Bloomberg</a>
          </div>
        `;

        // Add all content to the summary container
        newsSummary.innerHTML = summaryContent;

        // Now animate everything word by word
        const allTextElements = newsSummary.querySelectorAll(
          ".news-headline, .news-content, .source-link, strong"
        );
        let wordIndex = 0;

        for (let element of allTextElements) {
          const text = element.textContent;
          const words = text.split(" ");
          element.innerHTML = "";

          words.forEach((word, index) => {
            const span = document.createElement("span");
            span.textContent = word + " ";
            span.className = "word-animate";
            span.style.animationDelay = `${wordIndex * 100}ms`;
            element.appendChild(span);
            wordIndex++;
          });
        }

        // Return a promise that resolves when all animations are complete
        return new Promise((resolve) => {
          const totalDuration = wordIndex * 100 + 300;
          setTimeout(resolve, totalDuration);
        });
      }

      function addMessage(content, isUser = false) {
        const chatArea = document.getElementById("chatArea");
        const messageDiv = document.createElement("div");
        messageDiv.className = `message ${isUser ? "user-message" : ""}`;

        if (isUser) {
          const messageContent = document.createElement("div");
          messageContent.className = "message-content";
          messageContent.innerHTML = content;

          const avatar = document.createElement("div");
          avatar.className = "avatar user-avatar";
          avatar.textContent = "You";

          messageDiv.appendChild(messageContent);
          messageDiv.appendChild(avatar);
        } else {
          const avatar = document.createElement("div");
          avatar.className = "avatar ai-avatar";
          avatar.textContent = "AI";

          const messageContent = document.createElement("div");
          messageContent.className = "message-content";
          messageContent.innerHTML = content;

          messageDiv.appendChild(avatar);
          messageDiv.appendChild(messageContent);
        }

        chatArea.appendChild(messageDiv);
        chatArea.scrollTop = chatArea.scrollHeight;

        return messageDiv.querySelector(".message-content");
      }

      function sendMessage() {
        if (!isMessageComplete()) return;

        const message = messageInput.value.trim();
        if (!message) return;

        addMessage(message, true);

        messageInput.value = "";
        sendButton.classList.remove("enabled");

        // Start the AI response after a brief delay
        setTimeout(() => {
          handleAIResponse();
        }, 500);
      }

      function openSource(url) {
        const sidebar = document.getElementById("sidebar");
        const iframe = document.getElementById("articleFrame");
        const body = document.body;

        iframe.src = url;
        sidebar.classList.add("open");
        body.classList.add("sidebar-open");
      }

      function closeSidebar() {
        const sidebar = document.getElementById("sidebar");
        const body = document.body;

        sidebar.classList.remove("open");
        body.classList.remove("sidebar-open");
      }

      // Auto-resize textarea
      messageInput.addEventListener("input", function () {
        this.style.height = "auto";
        this.style.height = Math.min(this.scrollHeight, 200) + "px";
      });
    </script>
  </body>
</html>
